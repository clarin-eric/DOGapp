{% extends 'UI/_content.html' %}
{% load dogui_extras %}
{% block result %}
    <div class='table-reponsive'>
        <table id='fetch_result_table'
               class='datatables-table stripe order-column row-border'>
            <thead>
                <tr>
                    <th>PID</th>
                    <th>Collection title</th>
                    <th>License</th>
                    <th>Description</th>
                    <th colspan="2">Referenced Resources<br>
                        <table>
                            <thead>
                                <tr>
                                    <th>Resource type</th>
                                    <th>PID (MIME type)</th>
                                </tr>
                            </thead>
                        </table>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for pid, fetch_result in fetch_response.items %}
                    <tr>
                        {% comment %}
                            PID
                        {% endcomment %}
                        <td>{{ pid }}</td>
                        {% if fetch_result %}
                            {% if fetch_result.HTTP_upstream_response_code %}
                                <td class="right" colspan="4">Upstream HTTP response: {{ fetch_result.HTTP_upstream_response_code }}</td>
                            {% else %}
                                {% comment %}
                                    Resource title
                                {% endcomment %}
                                <td>{{ fetch_result.title }}</td>
                                {% comment %}
                                    License
                                {% endcomment %}
                                <td>{{ fetch_result.license }}</td>
                                {% comment %}
                                    Description
                                {% endcomment %}
                                <td>{{ fetch_result.description }}</td>
                                {% comment %}
                                    Resources
                                {% endcomment %}
                                <td>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Resource type</th>
                                                <th>PID (MIME type)</th>
                                            </tr>
                                        </thead>
                                        {% if fetch_result %}
                                            <tr>
                                                {% if fetch_result.HTTP_upstream_response_code %}
                                                    <td>Upstream HTTP response: {{ fetch_result.HTTP_upstream_response_code }}</td>
                                                {% else %}
                                                    {% for ref_resources in fetch_result.ref_files %}
                                                        {% if ref_resources %}
                                                            <tr>
                                                                {% if ref_resources.ref_resources %}
                                                                    <td>
                                                                        {{ ref_resources.resource_type }}
                                                                    </td>
                                                                    <td>
                                                                        <div id="resourcepid{{ forloop.counter }}">
                                                                        {% for ref_resource in ref_resources.ref_resources %}
                                                                            <a href="{{ ref_resource.pid }}">{{ ref_resource.pid }}</a> {% if ref_resource.data_type %} ({{ ref_resource.data_type }}) {% else %} (unknown) {% endif %}  <button onclick="showSwitchboardPopup({alignSelector:'#resourcepid{{ forloop.parentloop.counter }}', alignRight:true}, {url:'{{ ref_resource.pid }}', origin:'dog-clarin',{% if ref_resource.data_type %} mimeType:'{{ ref_resource.data_type }}' {% endif %}});">SB</button>
                                                                            {% if not forloop.last %}
                                                                                <br>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                        </div>
                                                                    </td>
                                                                {% endif %}
                                                            </tr>
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                            </tr>
                                        {% endif %}
                                    </table>
                                </td>
                            {% endif %}
                        {% else %}
                            <td>NA</td>
                            <td>NA</td>
                            <td>NA</td>
                            <td>NA</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock result %}
